# Lefthook configuration
# Replaces Husky + lint-staged

pre-commit:
  parallel: true
  commands:
    lint-staged:
      run: bunx lint-staged
      stage_fixed: true  # Auto-stage files fixed by lint-staged

    check-large-files:
      run: |
        # Check for files with >300 lines of changes
        LARGE_FILES=$(git diff --cached --numstat | awk '$1 > 300 || $2 > 300 {print $3 ":" $1 "+" $2 "-"}')
        if [ -n "$LARGE_FILES" ]; then
          echo "‚ö†Ô∏è  Warning: Large file changes detected (>300 lines):"
          echo "$LARGE_FILES" | while read line; do
            echo "   üìÑ $line"
          done
          echo ""
          echo "üí° Consider:"
          echo "   ‚Ä¢ Splitting large changes into multiple commits/PRs"
          echo "   ‚Ä¢ Separating refactoring from feature work"
          echo "   ‚Ä¢ Reviewing if all changes are intentional"
          echo ""
          echo "Continue with commit? (y/n)"
          read -r response
          if [[ ! "$response" =~ ^[Yy]$ ]]; then
            echo "‚ùå Commit cancelled"
            exit 1
          fi
        fi
      stage_fixed: false

pre-push:
  commands:
    # Tests are run in CI - skip on push to avoid blocking
    # Uncomment below if you want to run tests on push (warning: slow)
    # tests:
    #   run: bun test
